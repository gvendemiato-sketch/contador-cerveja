<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üç∫ Contador de Cervejas</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f6f6;
  padding: 20px;
}

/* ===== HIST√ìRICO SOCIAL ===== */
.social-history {
  position: sticky;
  left: 15px;
  top: 20px;
  width: 260px;
  background: white;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.1);
}

.social-history h3 {
  text-align: center;
  margin-bottom: 8px;
}

.social-history ul {
  list-style: none;
  padding: 0;
  margin: 0;
  font-size: 13px;
}

.social-history li {
  margin-bottom: 6px;
  border-bottom: 1px dashed #eee;
  padding-bottom: 4px;
}

/* ===== CONTE√öDO ===== */
h1, h2 { text-align: center; }

.card {
  max-width: 400px;
  margin: 20px auto;
  background: white;
  padding: 18px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
}

.row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
  padding-bottom: 6px;
  border-bottom: 1px dashed #eee;
}

button {
  padding: 6px 10px;
  font-size: 14px;
  cursor: pointer;
}

.progress-wrapper {
  max-width: 420px;
  margin: 30px auto;
  text-align: center;
}

.progress-track::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to bottom,
    rgba(255,255,255,0.35),
    rgba(255,255,255,0)
  );
  pointer-events: none;
}

#runner {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 24px;
}

.meta-text {
  margin-top: 12px;
  font-weight: bold;
}

.chart-wrapper {
  max-width: 320px;
  margin: 20px auto;
}

/* ===== ANIMA√á√ïES ===== */
@keyframes beer-bounce {
  0% { transform: translateY(-50%) scale(1); }
  40% { transform: translateY(-60%) scale(1.05); }
  100% { transform: translateY(-50%) scale(1); }
}
.beer-animate { animation: beer-bounce .35s ease; }

@keyframes beer-win {
  0% { transform: translateY(-50%) scale(1); }
  50% { transform: translateY(-50%) scale(1.3); }
  100% { transform: translateY(-50%) scale(1.1); }
}
.beer-win { animation: beer-win .6s ease forwards; }

/* ===== AJUSTE RESPONSIVO DO HIST√ìRICO ===== */

/* ===== LAYOUT BASE (DESKTOP E MOBILE) ===== */
.layout {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 20px;
}



/* Mobile */
@media (max-width: 768px) {
  .social-history {
    position: static;
    width: 100%;
    max-width: 100%;
    margin-top: 30px;
  }

  .layout {
display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 20px;
    flex-direction: column;
  }

}

.main-content {
  max-width: 420px;
  width: 100%;
}


/* ===== CONTADOR SEMANAL ===== */

.weekly-card {
  max-width: 320px;
  margin: 25px auto 10px;
  background: #ffffff;
  border-radius: 12px;
  padding: 14px 16px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
}

.weekly-card h3 {
  text-align: center;
  margin-bottom: 12px;
  font-size: 15px;
  color: #444;
}

.weekly-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  font-size: 14px;
  border-bottom: 1px dashed #eee;
}

.weekly-row:last-child {
  border-bottom: none;
}

.weekly-row span:last-child {
  font-weight: bold;
  color: #222;
}



</style>
</head>

<body>

<h1>üç∫ Contador de Cervejas ‚Äì 2026</h1>

<div class="layout">

  <!-- HIST√ìRICO SOCIAL -->
  <div class="social-history">
    <h3>üìú Hist√≥rico</h3>
    <ul id="social-log"></ul>
  </div>

  <!-- CONTE√öDO PRINCIPAL -->
  <div class="main-content">

    <div class="card">
      <div class="row">
        <span id="label-jaime">Jaime</span>
        <span id="jaime">0</span>
        <button onclick="removeBeer('jaime')">-0,5</button>
        <button onclick="addBeer('jaime')">+0,5</button>
      </div>

      <div class="row">
        <span id="label-cux">Cux</span>
        <span id="cux">0</span>
        <button onclick="removeBeer('cux')">-0,5</button>
        <button onclick="addBeer('cux')">+0,5</button>
      </div>

      <div class="row">
        <span id="label-celula">C√©lula</span>
        <span id="celula">0</span>
        <button onclick="removeBeer('celula')">-0,5</button>
        <button onclick="addBeer('celula')">+0,5</button>
      </div>
    </div>

    <h2>Total do grupo: <span id="total">0</span> üç∫</h2>

    <div class="progress-wrapper">
      <div>üèÅ 31/12/2026</div>
      <div class="progress-track">
        <div id="runner">üç∫</div>
      </div>
      <div id="meta-text" class="meta-text"></div>
    </div>

    <div class="chart-wrapper">
      <canvas id="beerChart"></canvas>
    </div>

	<!-- ===== CONTADOR SEMANAL ===== -->
<div class="weekly-card">
  <h3>üìÖ Consumo da Semana (Seg ‚Üí Dom)</h3>

  <div class="weekly-row">
    <span>Jaime</span>
    <span id="week-jaime">0.0</span>
  </div>

  <div class="weekly-row">
    <span>Cux</span>
    <span id="week-cux">0.0</span>
  </div>

  <div class="weekly-row">
    <span>C√©lula</span>
    <span id="week-celula">0.0</span>
  </div>
</div>

  </div>
</div>

</body>


<!-- Firebase + Chart -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBbhjdbYuR9o4dBZtIuE8tr8H4-CEMA2xM",
  authDomain: "one-thousand-beer.firebaseapp.com",
  projectId: "one-thousand-beer"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const docRef = db.collection("grupos").doc("cerveja_2026");

async function garantirSemanaAtual() {
  const snap = await docRef.get();
  const data = snap.data();
  const monday = getMonday();

  if (!data.week || data.week.start !== monday) {
    await docRef.update({
      week: {
        start: monday,
        jaime: 0,
        cux: 0,
        celula: 0
      }
    });
  }
}
garantirSemanaAtual();


/* ===== HIST√ìRICO ===== */
let historico = [];
let ultimoLider = null;
let metasBatidas = new Set();

function logEvento(texto) {
  historico.unshift("üç∫ " + texto);
  if (historico.length > 10) historico.pop();
  document.getElementById("social-log").innerHTML =
    historico.map(e => `<li>${e}</li>`).join("");
}

function getMonday(date = new Date()) {
  const d = new Date(date);
  const day = d.getDay(); // 0=Dom, 1=Seg...
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  d.setDate(diff);
  d.setHours(0,0,0,0);
  return d.toISOString().slice(0,10); // YYYY-MM-DD
}


docRef.onSnapshot(doc => {
  const d = doc.data();
  const total = d.jaime + d.cux + d.celula;

  ["jaime","cux","celula"].forEach(n => document.getElementById(n).innerText = d[n]);
  document.getElementById("total").innerText = total.toFixed(1);

  atualizarRanking(d);
  atualizarCorrida(total);
  atualizarTextoMeta(total);
  atualizarHistorico(d, total);

  beerChart.data.datasets[0].data = [d.jaime, d.cux, d.celula];
  beerChart.update();

if (d.week) {
  document.getElementById("week-jaime").innerText = d.week.jaime.toFixed(1);
  document.getElementById("week-cux").innerText = d.week.cux.toFixed(1);
  document.getElementById("week-celula").innerText = d.week.celula.toFixed(1);
}


});

function atualizarHistorico(d, total) {
  const arr = [
    {n:"Jaime",v:d.jaime},
    {n:"Cux",v:d.cux},
    {n:"C√©lula",v:d.celula}
  ].sort((a,b)=>b.v-a.v);

  if (arr[0].v !== arr[1].v && arr[0].n !== ultimoLider) {
    logEvento(`${arr[0].n} virou l√≠der ü•á`);
    ultimoLider = arr[0].n;
  }

  if (arr[0].v === arr[1].v) {
    logEvento("Empate detectado ü§ù");
  }

  [250,500,750,950,1000].forEach(m => {
    if (total >= m && !metasBatidas.has(m)) {
      logEvento(`O time chegou √† marca de ${m} üçª`);
      metasBatidas.add(m);
    }
  });
}

/* ===== RANKING ===== */
function atualizarRanking(d){
  const p=[
    {n:"jaime",v:d.jaime},
    {n:"cux",v:d.cux},
    {n:"celula",v:d.celula}
  ].sort((a,b)=>b.v-a.v);

  const vals=p.map(x=>x.v);
  const uniq=new Set(vals);

  const set=(x,e)=>document.getElementById("label-"+x.n).innerText=`${e} ${x.n[0].toUpperCase()+x.n.slice(1)}`;

  if(uniq.size===1){p.forEach(x=>set(x,"üçª"));return;}
  if(uniq.size===2){
    if(p[0].v===p[1].v){set(p[0],"ü§ù");set(p[1],"ü§ù");set(p[2],"üê¢");return;}
  }
  set(p[0],"ü•á");set(p[1],"üëΩ");set(p[2],"üê¢");
}

/* ===== PROGRESSO ===== */
function atualizarCorrida(total){
  const perc=Math.min(total/1000*100,100);
  const r=document.getElementById("runner");
  r.style.right=`calc(${100-perc}% - 12px)`;
  r.classList.remove("beer-animate");void r.offsetWidth;r.classList.add("beer-animate");
}

function atualizarTextoMeta(total){
  const r=document.getElementById("meta-text");
  if(total>=1000){
    r.innerText="üéâ META ATINGIDA! 1000 BRATCHOLAS üçªüî•";
    document.getElementById("runner").classList.add("beer-win");
  } else {
    r.innerText=`‚è≥ Faltam ${(1000-total).toFixed(1)} bratcholas`;
  }
}

/* ===== BOT√ïES ===== */
function addBeer(n) {
  docRef.update({
    [n]: firebase.firestore.FieldValue.increment(0.5),
    [`week.${n}`]: firebase.firestore.FieldValue.increment(0.5)
  });
}

function removeBeer(n) {
  docRef.get().then(doc => {
    const data = doc.data();
    if (data[n] >= 0.5 && data.week[n] >= 0.5) {
      docRef.update({
        [n]: firebase.firestore.FieldValue.increment(-0.5),
        [`week.${n}`]: firebase.firestore.FieldValue.increment(-0.5)
      });
    }
  });
}


/* ===== GR√ÅFICO ===== */
const beerChart=new Chart(document.getElementById("beerChart"),{
  type:"pie",
  data:{
    labels:["Jaime","Cux","C√©lula"],
    datasets:[{data:[1,1,1],backgroundColor:["#81c784","#fff176","#ffb74d"]}]
  }
});
</script>

</body>
</html>



























